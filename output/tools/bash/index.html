<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title></title>
    
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="nanoc 3.6.5"> 
  </head>


    <body>
    <div class="navbar navbar-fixed-top navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">xNotes</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            
        
          </ul>
        </div><!-- /.nav-collapse -->
      </div><!-- /.container -->
    </div><!-- /.navbar -->

    <div class="container">
      <div class="row">
        <div class="col-md-9" id="main">
          <h1 id="bash">Bash</h1>

<h2 id="nohup">Nohup</h2>

<p>Run command in background and redirect output to file.</p>

<pre><code>nohup command &gt; output &amp; 
</code></pre>

<p>Quote from Wikipedia: nohup is a POSIX command to ignore the HUP (hangup) signal, enabling the command to keep running after the user who issues the command has logged out. The HUP (hangup) signal is by convention the way a terminal warns depending processes of logout. Then use</p>

<pre><code>tail output 
</code></pre>

<p>to print the last few lines of the output.</p>

<h2 id="start-and-stop-daemons">Start and Stop Daemons</h2>

<h3 id="pattern">Pattern</h3>

<pre><code>#!/bin/bash
usage="Usage: server.sh (start|stop)"

# command is 'start' or 'stop'
command=$1

case $command in
    (start)
        ...
        ;;

    (stop)
        ...
        ;;

    (*)
        echo $usage
        exit 1
        ;;
esac
</code></pre>

<h3 id="get-pid">Get PID</h3>

<p>Simple Case: Use pgrep to get pid</p>

<pre><code>pid_mongod=`pgrep mongod`
</code></pre>

<p>Complicated Case: Multiple programs under the same name is running, like Hadoop daemons and Solr daemon are all simply shown as java:</p>

<pre><code>pid_solr=`ps -eo pid,args | grep 'java -jar start.jar'| grep -v grep | cut -c1-6`
</code></pre>

<p>Step by Step:</p>

<ul>
<li>ps -e: show all the pids</li>
  <li>
    <p>ps -o pid,args: specify the fields to show:</p>

    <p>$ ps -eo pid,args
  12498 -bash
  14132 java -jar start.jar
  17489 grep java -jar start.jar
  …</p>
  </li>
  <li>
    <p>grep ‘java -jar start.jar’: only leave the specified commands:</p>

    <p>$ ps -eo pid,args | grep ‘java -jar start.jar’
  14132 java -jar start.jar
  17489 grep java -jar start.jar</p>
  </li>
  <li>
    <p>grep -v grep: exclude the grep itself:</p>

    <p>$ ps -eo pid,args | grep ‘java -jar start.jar’| grep -v grep
  14132 java -jar start.jar</p>
  </li>
  <li>
    <p>cut -c1-6: cut the first 6 characters:</p>

    <p>$ ps -eo pid,args | grep ‘java -jar start.jar’| grep -v grep | cut -c1-6
  14132</p>
  </li>
</ul><p>Other ways to get pid: <code>echo $$</code> or <code>echo $!</code>.</p>

<h3 id="start-daemon">Start Daemon</h3>

<pre><code>if kill -0 $pid_mongod &gt; /dev/null 2&gt;&amp;1; then
    echo Database is already running ...
else
    echo Starting Database ...
    bin/mongod &amp;
fi
</code></pre>

<p>Step by Step:</p>

<ul>
<li>kill -0 $pid_mongod: -0 for testing if the pid is available to kill. It will return 0 if you can kill <pid>, 1 if <pid> is invalid or you do not have access.</pid></pid>
</li>
  <li>… &gt; /dev/null 2&gt;&amp;1: redirect the output to /dev/null, a blackhole. 2 stands for STDERR, 1 for STDOUT. This command means redirect STDOUT to /dev/null, and redirect STDERR to STDOUT(which is /dev/null), so both STDOUT and STDERR will be quiet. Remember the &amp; before destination.</li>
  <li>
    <p>bin/mongod &amp;: if it is not running, start the daemon. Remember the &amp; for running in the background.
Wait before it is up:</p>

    <p>while true; do
      sleep 1
      if pgrep mongod; then
          break
      fi
  done</p>
  </li>
</ul><h3 id="stop-daemon">Stop Daemon</h3>

<p>Similar to the previous section.</p>

<div class="CodeRay"><div class="code"><pre><code class="language-sh">if kill -0 $pid_mongod &gt; /dev/null 2&gt;&amp;1; then
    echo Stopping mongod Server ...
    kill -9 $pid_mongod
else
    echo No mongod Server to stop ...
fi</code></pre></div></div>
        </div>
        <div class="col-md-3">
        </div>
        
      </div>
    </div>

    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/coderay.css">
</html>
